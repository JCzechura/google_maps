<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
    </style>
	<link rel="Stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?&sensor=false">
    </script>
    <script type="text/javascript">
	lat_lng = new Array();
	markers_out= [];
	var l = 0;
	var map;
	var gps_correct = true;
	//var paths = [];
	var NS_arr = [];
	var WE_arr = [];
	var titles = [];
	var IDcodes = [];
	var BaseIDCodes = [];
	var BaseAddresses = [];
	var BasePositions = [];
	var first_line = false;
	
	document.onreadystatechange = function() {
  if (document.readyState === 'complete') {
    fn();
	fn2();
  }
};
function fn()
{
	document.getElementById('file').onchange = function()
	{
		var file = this.files[0];
		var reader = new FileReader();
		reader.readAsText(file, 'ISO-8859-1');
		reader.onload = function(progressEvent)
		{
			console.log(this.result);
			var lines = this.result.split('\n');
			var title1 = "";
			for(var line = 0; line < lines.length; line++)
			{
				console.log(lines[line]);
				console.log(line);
				var res = lines[line].split('#'); 
				if (res.length == 5){console.log("res = 5");}                     // TUTAJ DOPISAC JESCZE OBSLUGE JAK SA PIERWSZE LINIJKI ###0# albo ###IDCode#0# !!!!!!!!!!!!!!!!!!!
				else if (res.length == 1 ){console.log("res = 1");}
				else
				{                                          // TUTAJ DOPISAC JESCZE OBSLUGE BŁĘDBYCH DANYCH czyli ostatniego res == 0, ze zmienną gps_correct !!!!!!!!!!!!!!!!!!!
					//jesli sprawdzono i dana jest poprawna (osttani res ==1) to:
					console.log("res nie 1 ani nie 5");
					var NS1 = parseFloat(res[1]) + parseFloat(res[2])/60;
					if (res[3] == "N")
						; else NS1 = NS1 * (-1);
					var WE1 = parseFloat(res[4]) + parseFloat(res[5])/60;
					if (res[6] == "E")
						; else WE1 = WE1 * (-1);
					if 	(( 49.14578361775004 < NS1 < 54.92082843149136 ) & ( 14.6337890625 < WE1 < 24.2578125 ))
					{
						console.log(NS_arr);
						console.log(WE_arr);
						console.log(first_line);
						if (first_line == false)
						{
							first_line = true;
							if  (res[7].length>4)
							{
								IDcodes.push(res[7]);
								if (res[0].split(':').length == 3)
									title1 = res[0] + " - " +  res[7];
								else
									title1 = res[7];
							}else if (res[0].split(':').length == 3)
								title1 = res[0];
							else title1 = "";
							console.log(title1);
							titles.push(title1);
							NS_arr.push(NS1);
							WE_arr.push(WE1);
							//paths.push(new google.maps.LatLng(NS1,WE1));
							var markerl = new google.maps.Marker({
								position: new google.maps.LatLng(NS1,WE1),
								map: map,
								visible: true,
								icon: 'green_button.png',
								title:title1
							});
							if (res[7] != "1")
								markerl.setIcon('trash11.png');
							if (res[7] == "!!!")
								markerl.setIcon('landfill1.png');
							markers_out.push(markerl);
						}
						else
						{
							var lat = NS_arr[NS_arr.length - 1];
							var lng = WE_arr[WE_arr.length - 1];
							console.log(lat);
							console.log(lng);
							if ((Math.abs(lat - NS1) > 0.0003)  || (Math.abs(lng - WE1) > 0.0005) || res[7] != "1" || res[7] == "!!!")
							{
								if  (res[7].length>4)
								{
									IDcodes.push(res[7]);
									if (res[0].split(':').length == 3)
										title1 = res[0] + " - " +  res[7];
									else
										title1 = res[7];
								}else if (res[0].split(':').length == 3)
									title1 = res[0];
								else title1 = "";
									console.log(title1);
									titles.push(title1);
									NS_arr.push(NS1);
									WE_arr.push(WE1);
									//paths.push(new google.maps.LatLng(NS1,WE1));
									var markerl = new google.maps.Marker({
										position: new google.maps.LatLng(NS1,WE1),
										map: map,
										visible: true,
										icon: 'green_button.png',
										title:title1
									});
									if (res[7] != "1")
										markerl.setIcon('trash11.png');
									if (res[7] == "!!!")
										markerl.setIcon('landfill1.png');
									markers_out.push(markerl);
							}
						}
					}
				}
			}
			console.log("skonczylem");
			console.log(BaseIDCodes);
			console.log(IDcodes);
			for(var i = 0; i < BaseIDCodes.length; i++)
			{
				var IDChecked = false;
				for(var j = 0; j < IDcodes.length; j++)
				{
				console.log("BaseIDCodes[i]");
				console.log(BaseIDCodes[i]);
				console.log("IDcodes[j]");
				console.log(IDcodes[j]);
					if (IDcodes[j] == BaseIDCodes[i])
						IDChecked = true;
				console.log(IDChecked);
				}
				console.log(IDChecked);
												console.log(IDChecked);
																console.log(IDChecked);
				if (IDChecked == false)
					var markerl = new google.maps.Marker({
						position: BasePositions[i],
						map: map,
						visible: true,
						icon: 'trash_red.png',
						title:BaseAddresses[i]
					});
			}
			console.log("skonczylem całkiem");
			var deb = "12345671234567222";
			console.log(parseFloat(deb));
			console.log(parseFloat(BaseIDCodes[3]));
			   var domain, number, pieces;

    domain =BaseIDCodes[3];
    number = 13;//Math.ceil(Math.random() * (domain.length - 1));
    pieces = [domain.substring(number, -number), domain.substring(number)];

    console.log(pieces);
	 console.log(parseFloat(pieces[0]));
	  console.log(parseFloat(pieces[1]));
		};
	};
}
function fn2()
{
	document.getElementById('file1').onchange = function()
	{	
		var file = this.files[0];
		var reader = new FileReader();
		reader.readAsText(file, 'ISO-8859-1');
		reader.onload = function(progressEvent)
		{
			console.log(this.result);
			var lines = this.result.split('\n');
			for(var line = 0; line < lines.length; line++)
			{
				console.log(lines[line]);
				console.log(line);
				var res = lines[line].split('#'); 
				BaseIDCodes.push(res[0]);
				BaseAddresses.push(res[1]);
				BasePositions.push(new google.maps.LatLng(res[2],res[3]));	
			}
		}
	
	};
}
	
	function markers(_callback)
	{
		dodajMarkerSnap(wspolrzedne);
		dodajMarkerSnap(wspolrzedne2);
		_callback();
	}
	
	function dodajMarker(lat,lon,opcjeMarkera)
			{
				opcjeMarkera.position = new google.maps.LatLng(lat,lon);
				
				opcjeMarkera.map = map;
				var marker = new google.maps.Marker(opcjeMarkera);
			}
	function title_time()
	{
		console.log("zara nowy tytex");
		var myVar = setTimeout(title, 10000);
	}
	function title()
	{
	console.log("zmieniam tyt");
		markers_out[markers_out.length-1].setTitle("new title");
		 console.log("nowy tytex");
	}
      function initialize() {
        var myOptions = {
          center: new google.maps.LatLng(54.0924200,18.7778700),
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
		  disableDefaultUI: false
        };
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		 google.maps.event.addListener(map, 'click', function(event) {
   console.log("Latitude: " + event.latLng.lat() + " " + ", longitude: " + event.latLng.lng());
   
  });
}
    </script> 
  </head>
  <body padding = 2cm 4cm 3cm 4cm background="ccc.png" onload="initialize()">
  <h1>System wspomagania monitoringu gospodarki odpadami komunalnymi</h1>
  <div id="rodzic">
    <div id="map_canvas" style="width:50%; height:95%"></div>
	<div id="filef" ><label for="file" class="custom-file-upload">
    <i class="fa fa-cloud-upload"></i> Załaduj trasę
</label>
<input id="file" type="file"/>
<label for="file1" class="custom-file-upload">
    <i class="fa fa-cloud-upload"></i> Załaduj bazę adresów
</label>
<input id="file1" type="file"/>
</div>
	</div>
  </body>
</html>