<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?&sensor=false">
    </script>
    <script type="text/javascript">
	lat_lng = new Array();
	markers_out= new Array();
	lat_lng_out = new Array();
	var l = 0;
	var map;
	var fin = false;
	var wspolrzedne = new google.maps.LatLng(54.07232,18.76756320000004);
	var wspolrzedne2 = new google.maps.LatLng(54.073,18.76756320000004);
	//var wspolrzedne3 = new google.maps.LatLng(54.075,18.76756320000004);
	var paths = [];
	//paths.push(new google.maps.LatLng(54.07232,18.76756320000004));
	//paths.push(new google.maps.LatLng(54.073,18.7675632000000));
	//paths.push(new google.maps.LatLng(54.075,18.76756320000004));
	var coords1 = [];
	var coords2 = [];
	document.onreadystatechange = function() {
  if (document.readyState === 'complete') {
    fn();
  }
};
function fn()
{
	var times = [];
	var names = [];
	document.getElementById('file').onchange = function(){
		var file = this.files[0];
		var reader = new FileReader();
		reader.readAsText(file, 'ISO-8859-1');
		reader.onload = function(progressEvent){
			console.log(this.result);
			var lines = this.result.split('\n');
			for(var line = 0; line < lines.length; line++){
				console.log(lines[line]);
				console.log(line);
				var res = lines[line].split("#");
				times.push(res[0]);
				var NS1 = parseFloat(res[1]);
				var NS2 = parseFloat(res[2]);
				var NS2dec = NS2/60;
				NS1 = NS1+NS2dec;
				if (res[3] == "N")
					; else NS1 = NS1 * (-1);
				console.log(NS1);
				var WE1 = parseFloat(res[4]);
				var WE2 = parseFloat(res[5]);
				var WE2dec = WE2/60;
				WE1 = WE1+WE2dec;
				if (res[6] == "E")
					; else WE1 = WE1 * (-1);
				names.push(res[7]);
				coords1.push(NS1);
				coords2.push(WE1);
				console.log("times");
				console.log(times);
				console.log("names");
				console.log(names);
				console.log("NS");
				console.log(coords1);
				console.log("WE");
				console.log(coords2);
				paths.push(new google.maps.LatLng(NS1,WE1));
			}
			console.log("skonczylem");
			fin = true;
			dodajMarkerSnap(paths,names,rysuj);
		};
	};
}
	
	
	
	
	function markers(_callback)
	{
		dodajMarkerSnap(wspolrzedne);
		dodajMarkerSnap(wspolrzedne2);
		_callback();
	}
	
	function dodajMarker(lat,lon,opcjeMarkera)
			{
				// tworzymy marker z współrzędnymi i opcjami z argumentów funkcji dodajMarker
				opcjeMarkera.position = new google.maps.LatLng(lat,lon);
				
				opcjeMarkera.map = map; // obiekt mapa jest obiektem globalnym!
				var marker = new google.maps.Marker(opcjeMarkera);
			}
	function dodajMarkerSnap(wspolrzedne,names,_callback)
	{
	for (var i = 0; i < wspolrzedne.length; i++) 
	{
		console.log(i);
		var markerl = new google.maps.Marker({
             position: wspolrzedne[i],
             map: map,
			 visible: true,
			 icon: 'green_button.png',
             title:names[i]
			});
			if (names[i] != "1")
				 markerl.setIcon('trash11.png');
			if (names[i] == "24848484856654951666750533")
				 markerl.setIcon('trash_red.png');
			if (names[i] == "24848484865575655655256653")
				 markerl.setIcon('trash_red.png');
			if (names[i] == "!!!")
				 markerl.setIcon('landfill1.png');
		/*	
		var requestSnap = {
			origin:wspolrzedne[i], 
			destination:wspolrzedne[i],
			travelMode: google.maps.DirectionsTravelMode.DRIVING
		};
		directionsServiceSnap.route(requestSnap, function(response, status) {
		if (status == google.maps.DirectionsStatus.OK) {
			if (names[lat_lng.length].length < 2)
			{
			 var marker = new google.maps.Marker({
             position: response.routes[0].legs[0].start_location, 
             map: map,
			 //icon: pinImage,
             //shadow: pinShadow,
			 visible: false
             //title:"Hello World!"
			});
			}
			else
			{
			var marker = new google.maps.Marker({
             position: response.routes[0].legs[0].start_location, 
             map: map,
             title:names[lat_lng.length]
			});
			}
			var lat = marker.getPosition().lat();
			var lng = marker.getPosition().lng();
			console.log(lat);
			console.log(lng);
			var myLatlng = new google.maps.LatLng(lat,lng);
            lat_lng.push(myLatlng);
			console.log(lat_lng.length);
			markers_out.push(marker);
			if (lat_lng.length == names.length)
		{
			console.log("wchodze w callback");
			_callback();
			
		}
		}
		});
		*/
	}
	}
	function getIcon(color) {
    return MapIconMaker.createMarkerIcon({width: 20, height: 34, primaryColor: color, cornercolor:color});
	}
	function rysuj_time()
	{
		var myVar = setTimeout(rysuj, 3000);
	}
	
	function title_time()
	{
		console.log("zara nowy tytex");
		var myVar = setTimeout(title, 10000);
	}
	function title()
	{
	console.log("zmieniam tyt");
		markers_out[markers_out.length-1].setTitle("new title");
		 console.log("nowy tytex");
	}
	
	function rysuj()
	{	
		   console.log("wchodze w rysuj");
	       var path = new google.maps.MVCArray();
		   var path1 = new google.maps.MVCArray();
           var service = new google.maps.DirectionsService();
		   var directionsDisplay = new google.maps.DirectionsRenderer({map: map});
           var infoWindow = new google.maps.InfoWindow();
           var poly = new google.maps.Polyline({ map: map, strokeColor: '#FF8200' });
		   var poly1 = new google.maps.Polyline({ map: map, strokeColor: '#FF8200' });
		   console.log(lat_lng.length);
		    rysuj_linie(1,lat_lng[0], lat_lng[1], path, service, poly, directionsDisplay);
			 rysuj_linie(2,lat_lng[1], lat_lng[2], path1, service, poly1, directionsDisplay);
			 title_time();
          // for (var i = 0; i < (lat_lng.length-1); ++i) {
		   // rysuj_linie(i,lat_lng[i], lat_lng[i + 1], path1, service, poly, directionsDisplay);
		   /*
		   console.log(i);
               if ((i + 1) < lat_lng.length) {
                   var src = lat_lng[i];
                   var des = lat_lng[i + 1];
                   path.push(src);
                   poly.setPath(path);
                   service.route({
                       origin: src,
                       destination: des,
                       travelMode: google.maps.DirectionsTravelMode.DRIVING
                   }, function (result, status) {
                       if (status == google.maps.DirectionsStatus.OK) {
                           for (var j = 0, len = result.routes[0].overview_path.length; j < len; j++) {
                               path.push(result.routes[0].overview_path[j]);
                           }
                       }
                   });
               }
			   */
           //}
		   console.log("wychodze z rysuj");
	}
	
	
	function rysuj_inne()
	{
	console.log("skonczylem");
	 var directionsService = new google.maps.DirectionsService;
console.log("skonczylem");
        // Create a renderer for directions and bind it to the map.
        var directionsDisplay = new google.maps.DirectionsRenderer({map: map});
console.log("skonczylem");
        // Instantiate an info window to hold step text.
        var stepDisplay = new google.maps.InfoWindow;
console.log("skonczylem");
        // Display the route between the initial start and end selections.
        calculateAndDisplayRoute(directionsDisplay, directionsService, markers_out, stepDisplay, map);
	
	}
		
	function rysuj_linie(i, src1, des2, path, service, poly, directionsDisplay)	
	{ 
			   console.log("iter");
			   console.log(i);
                   var src = src1;
                   var des = des2;
				   //path = [];
                   path.push(src);
                   poly.setPath(path);
                   service.route({
                       origin: src,
                       destination: des,
                       travelMode: google.maps.DirectionsTravelMode.DRIVING
                   }, function (result, status) {
                       if (status == google.maps.DirectionsStatus.OK) {
                           for (var j = 0, len = result.routes[0].overview_path.length; j < len; j++) {
						   console.log(j);
                               path.push(result.routes[0].overview_path[j]);
                           }
                       }
                   });
	
	}
	
	
      function initialize() {
        var myOptions = {
          center: new google.maps.LatLng(54.0924200,18.7778700),
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
		  disableDefaultUI: false
        };
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		 google.maps.event.addListener(map, 'click', function(event) {
   console.log("Latitude: " + event.latLng.lat() + " " + ", longitude: " + event.latLng.lng());
  });
}
    </script> 
  </head>
  <body onload="initialize()">
    <div id="map_canvas" style="width:100%; height:100%"></div>
	<div><input type="file" name="file" id="file"></div>
  </body>
</html>